# Video Processing Web Application

This project provides a web interface and REST API for transcribing and summarizing video files. It uses Whisper.cpp for transcription and MLX Phi4 for summarization, generating text summaries and Logseq-compatible Markdown notes.

## Features

- User-friendly web interface for video uploads
- Video to audio conversion using FFmpeg
- Speech-to-text transcription using Whisper.cpp Large V3
- Text summarization using MLX Phi4 large language model
- Logseq-compatible note generation
- REST API for programmatic access
- Comprehensive logging and error handling
- Support for MP4, AVI, MOV, and MKV video formats

## Project Structure

```
.
├── app.py              # Flask web application and API server
├── main.py             # CLI script for direct usage
├── templates/          # Web interface templates
│   └── index.html      # Main web interface
├── static/             # Static web assets
│   └── js/
│       └── VideoProcessor.js  # React component for video upload
├── transcribe/         # Core package
│   ├── __init__.py
│   ├── summarize_model.py  # LLM summarization
│   ├── transcribe.py      # Whisper transcription
│   ├── get_video.py       # Video processing
│   └── utils.py           # Utilities
├── files/              # Generated files
│   ├── uploads/        # Temporary video uploads
│   ├── audio/         # Extracted audio
│   ├── transcripts/   # Text transcripts
│   ├── summaries/     # Generated summaries
│   └── logseq/        # Logseq notes
├── *.log              # Log files
└── requirements.txt    # Dependencies
```

## Prerequisites

- **Python 3.7+** ([python.org](https://python.org/))
- **Whisper.cpp** ([GitHub Repository](https://github.com/ggerganov/whisper.cpp))
  - Build and ensure the `main` executable is in your PATH
- **FFmpeg** ([ffmpeg.org](https://ffmpeg.org/))
  - macOS: `brew install ffmpeg`
  - Linux: `apt-get install ffmpeg`
  - Windows: Download from ffmpeg website
- **MLX** (Follow MLX installation instructions)
- **Spacy Model**:
  ```bash
  python -m spacy download en_core_web_sm
  ```

## Installation

1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd <repository-name>
   ```

2. Create and activate virtual environment:
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Unix/macOS
   .venv\Scripts\activate     # Windows
   ```

3. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

4. Create required directories:
   ```bash
   mkdir -p templates static/js files/{uploads,audio,transcripts,summaries,logseq}
   ```

## Usage

### Web Interface

1. Start the Flask application:
   ```bash
   python app.py
   ```

2. Open your web browser and navigate to:
   ```
   http://localhost:5000
   ```

3. Use the web interface to:
   - Upload videos through drag-and-drop or file selection
   - Monitor processing progress
   - View and download generated files

### REST API

The application provides the following API endpoints:

1. **Process Video** (`POST /api/process`)
   ```bash
   curl -X POST \
     -F "file=@/path/to/video.mp4" \
     -F "title=My Video Title" \
     http://localhost:5000/api/process
   ```

   Response:
   ```json
   {
       "status": "success",
       "files": {
           "audio": "video_name.wav",
           "transcript": "video_name.txt",
           "summary": "video_name.txt",
           "logseq": "video_name.md"
       }
   }
   ```

2. **Check Status** (`GET /api/status`)
   ```bash
   curl http://localhost:5000/api/status
   ```

### Command Line Interface

For direct command-line usage:

```bash
python main.py --input_path "/path/to/video.mp4" --title "Video Title"
```

## Output Files

The process generates several files:

1. **Audio** (`files/audio/*.wav`)
   - Extracted audio in WAV format
   - 16kHz, mono, 16-bit PCM

2. **Transcript** (`files/transcripts/*.txt`)
   - Raw text transcription
   - Generated by Whisper.cpp

3. **Summary** (`files/summaries/*.txt`)
   - Bullet-point summary
   - Generated by MLX Phi4

4. **Logseq Note** (`files/logseq/*.md`)
   - Formatted Markdown note
   - Ready for import into Logseq

## Configuration

Key configuration settings in `app.py`:

```python
UPLOAD_FOLDER = 'files/uploads'
ALLOWED_EXTENSIONS = {'mp4', 'avi', 'mov', 'mkv'}
LOG_FILE = "api.log"
SUMMARIES_DIR = "files/summaries"
LOGSEQ_DIR = "files/logseq"
```

## Logging

The application maintains several log files:
- `api.log`: Web interface and API logs
- `transcribe.log`: Transcription process logs
- `summarization.log`: Summarization process logs
- `video_processing.log`: Video/audio conversion logs

## Troubleshooting

### Common Issues

1. **Web Interface Not Loading**
   - Verify Flask is running and port 5000 is available
   - Check browser console for JavaScript errors
   - Ensure all static files are in correct locations

2. **Upload Errors**
   - Verify file format is supported
   - Check file size limits
   - Ensure all directories have write permissions

3. **Processing Errors**
   - Check log files for detailed error messages
   - Verify all dependencies are installed
   - Ensure sufficient disk space

### Solutions

1. **Missing Dependencies**
   ```bash
   pip install -r requirements.txt
   python -m spacy download en_core_web_sm
   ```

2. **Permission Issues**
   ```bash
   chmod -R 755 files/
   ```

3. **Port Conflicts**
   - Modify port in app.py if 5000 is in use
   ```python
   app.run(debug=True, host='0.0.0.0', port=5001)
   ```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## License

MIT License

## Acknowledgments

- Whisper.cpp project
- MLX project
- FFmpeg project
- React and Flask communities
